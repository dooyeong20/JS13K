<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script type="text/javascript" src="src/player-small.js"></script>
    <script type="text/javascript" src="src/third_party/Blob.js"></script>
    <script type="text/javascript">
      function startDemo() {
        //----------------------------------------------------------------------------
        // Music data section
        //----------------------------------------------------------------------------
      
        // Song data
        var song = {
      songData: [
        { // Instrument 0
          i: [
          2, // OSC1_WAVEFORM
          100, // OSC1_VOL
          128, // OSC1_SEMI
          0, // OSC1_XENV
          3, // OSC2_WAVEFORM
          201, // OSC2_VOL
          128, // OSC2_SEMI
          0, // OSC2_DETUNE
          0, // OSC2_XENV
          0, // NOISE_VOL
          5, // ENV_ATTACK
          6, // ENV_SUSTAIN
          58, // ENV_RELEASE
          0, // ENV_EXP_DECAY
          0, // ARP_CHORD
          0, // ARP_SPEED
          0, // LFO_WAVEFORM
          195, // LFO_AMT
          6, // LFO_FREQ
          1, // LFO_FX_FREQ
          2, // FX_FILTER
          135, // FX_FREQ
          0, // FX_RESONANCE
          0, // FX_DIST
          32, // FX_DRIVE
          147, // FX_PAN_AMT
          6, // FX_PAN_FREQ
          121, // FX_DELAY_AMT
          6 // FX_DELAY_TIME
          ],
          // Patterns
          p: [1],
          // Columns
          c: [
            {n: [140,144,152,158,146,140,139,138,148,157,157,147,140,141,156,156,142,145,157,151,140,140,152,152,144,140,142,140,140,148,156,147],
             f: []}
          ]
        },
      ],
      rowLen: 5513,   // In sample lengths
      patternLen: 32,  // Rows per pattern
      endPattern: 0,  // End pattern
      numChannels: 1  // Number of channels
    };
        
        //----------------------------------------------------------------------------
        // Demo program section
        //----------------------------------------------------------------------------
      
        // Initialize music generation (player).
        var player = new CPlayer();
        player.init(song);
      
        // Generate music...
        var done = false;
        setInterval(function () {
          if (done) {
            return;
          }
      
          done = player.generate() >= 1;
      
          if (done) {
      
            // Put the generated song in an Audio element.
            var wave = player.createWave();
            var audio = document.createElement("audio");
            audio.src = URL.createObjectURL(new Blob([wave], {type: "audio/wav"}));
            audio.play();
          }
        }, 0);
      }
        </script>
  </head>
    <a-scene id="gameScene">
      <button class="a-enter-vr-button" id="playButton" onclick="startDemo();">play</button>
      <!-- environment -->
      <a-light id="light" type="ambient" color="#fff" intensity="0.3" position="0 20 -10"></a-light>
      <a-sky color="#171101" segments-width="5" segments-height="5"></a-sky>
      <a-plane
        position="0 0 0"
        height="500"
        width="500"
        rotation="-90 0 0"
        material="color: #010645; roughness: 0.9"
      ></a-plane>

      <a-box position="-250 15 0" height="30" width="500" color="#570c1e" material="roughness: 0.9" rotation="0 90 0"></a-box>
      <a-box position="250 15 0" height="30" width="500" color="#570c1e" material="roughness: 0.9" rotation="0 90 0"></a-box>
      <a-box position="0 15 -250" height="30" width="500" color="#570c1e" material="roughness: 0.9" rotation="0 0 0"></a-box>
      <a-box position="0 15 250" height="30" width="500" color="#570c1e" material="roughness: 0.9" rotation="0 0 0"></a-box>
    </a-scene>
  </body>
</html>
